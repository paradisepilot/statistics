
          %%%%% ~~~~~~~~~~~~~~~~~~~~ %%%%%

\section{Variance estimation for multi-stage sampling}
\setcounter{theorem}{0}
\setcounter{equation}{0}

Let $U$ be a finite population and $\mathcal{P}(U)$ the power set of $U$.
Let $p : \mathcal{S} \longrightarrow (0,1]$ be a $r$-stage sampling design ($r \geq 2$),
where $\mathcal{S} \subset \mathcal{P}(U)$ is the set of all admissible samples under the design $p$.
We express the hierarchical structure of the population $U$, with respect to the $r$-stage design $p$, as follows:
\begin{equation}
U
\;\;=\;\; \bigsqcup_{i \in U^{(1)}} U^{(2+)}_{i}
\;\;=\;\; \bigsqcup_{i \in U^{(1)}_{\color{white}i}} \bigsqcup_{a \in U^{(2)}_{i}}\, U^{(3)}_{ia}
\;\;=\;\; \cdots\;
\;\;=\;\; \bigsqcup_{i \in U^{(1)}_{\color{white}i}}\,\cdots\,\bigsqcup_{b \in U^{(r-1)}_{i\cdots}}\, U^{(r)}_{i\cdots b}
\end{equation}
where $U^{(1)}$ is the set of all primary sampling units (PSU),
and for each PSU $i \in U^{(1)}$, $U^{(2)}_{i}$ denotes the set of all secondary sampling units (SSU) contained in $i \in U^{(1)}$,
and for each SSU $a \in U^{(2)}_{i}$, $U^{(3)}_{ia}$ denotes the set of all tertiary sampling units (TSU) contained in $a \in U^{(2)}_{i}$,
and so on.
Similarly, we express the hierachical structure of every admissible sample $s \in \mathcal{S}$ as follows:
\begin{equation}
s
\;\;=\;\; \bigsqcup_{i\in s^{(1)}} s^{(2+)}_{i}
\;\;=\;\; \bigsqcup_{i\in s^{(1)}_{\color{white}i}} \bigsqcup_{a \in s^{(2)}_{i}}\, s^{(3)}_{ia}
\;\;=\;\; \cdots\
\end{equation}
Let $y : U \longrightarrow \Re$ be a population characteristic.
Let $T$ be its population total, i.e.
\begin{equation}
T
\;\;=\;\; \sum_{u \in U}\,y_{u}
\;\;=\;\; \sum_{i\in U^{(1)}_{\color{white} i}}T_{i}
\;\;=\;\; \sum_{i\in U^{(1)}_{\color{white} i}}\;\sum_{a \in U^{(2)}_{ia}}T_{ia}
\;\;=\;\; \cdots
\;\;=\;\; \sum_{i \in U^{(1)}_{\color{white} i}}\,\cdots\,\sum_{u \in U^{(r)}_{i\cdots}}\,y_{u}
\end{equation}

\begin{theorem}
\mbox{}\vskip 0.1cm
\noindent
If $\widehat{T}_{i} : \mathcal{S}^{(2+)}_{i} \longrightarrow \Re$ is an unbiased estimator for $T_{i}$,
for each \textnormal{PSU} $i \in U^{(1)}$,
then the random variable $\widehat{T} : \mathcal{S} \longrightarrow \Re$ defined as follows:
\begin{equation}
\widehat{T}(s)
\;\;:=\;\;
\sum_{i\in s^{(1)}}\,\frac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\end{equation}
is a design-unbiased estimator for
\begin{equation*}
T \;\; = \;\; \sum_{i\in U^{(1)}_{\color{white} i}}T_{i}
\end{equation*}
If the $r$-stage sampling design has invariant and independent subsampling,
then the design-variance of $\widehat{T}$ is given by:
\begin{equation}
\Var\!\left[\;\widehat{T}\;\right]
\;\;=\;\;
\underset{\textnormal{V}_{\textnormal{PSU}}}{\underbrace{\Var^{(1)}\!\left(E^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)}}
\;+\;
\underset{\textnormal{V}_{\textnormal{subsampling}}}{\underbrace{E^{(1)}\!\left(\Var^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)}},
\end{equation}
where
\begin{eqnarray*}
\Var^{(1)}\!\left(E^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)
&=&
\sum_{i\in U^{(1)}}\sum_{j\in U^{(1)}}\,\Delta^{(1)}_{ij}\frac{T_{i}}{\pi^{(1)}_{i}}\frac{T_{j}}{\pi^{(1)}_{j}},\quad\textnormal{and}
\\
E^{(1)}\!\left(\Var^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)
&=&
\sum_{i\in U^{(1)}}\frac{V_{i}}{\pi^{(1)}_{i}},
\end{eqnarray*}
with
\begin{equation}
V_{i} \;:=\; \Var^{(2+)}\!\left[\;\widehat{T}_{i}\;\right]
\quad\textnormal{and}\quad
\Delta^{(1)}_{ij}\;:=\;
\left\{
\begin{array}{cl}
\pi^{(1)}_{i}\left(1 - \pi^{(1)}_{i}\right), & \textnormal{if}\;\; i = j
\\ \\
\pi^{(1)}_{ij} - \pi^{(1)}_{i}\pi^{(1)}_{j}, & \textnormal{if}\;\; i \neq j
\end{array}
\right.
\end{equation}
Furthermore, if $\widehat{V}_{i} : \mathcal{S}^{(2+)}_{i} \longrightarrow \Re$
is an unbiased estimator for
$V_{i} := \Var^{(2+)}\!\left[\,\widehat{T}_{i}\,\right]$, and
$\pi^{(1)}_{i} > 0$, $\pi^{(1)}_{ij} > 0$ for any \textnormal{PSU}s $i,j \in U^{(1)}$,
then
\begin{eqnarray*}
\widehat{\Var}\!\left[\,\widehat{T}\,\right]\!(s)
&:=&
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\cdot
\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
\;+\;
\sum_{i\in s^{(1)}}\,\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}},
\\
\widehat{\Var}^{(1)}\!\left[\,\widehat{T}\,\right]\!(s)
&:=&
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\cdot
\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
\;+\;
\sum_{i\in s^{(1)}}\,\left(1 - \dfrac{1}{\pi^{(1)}_{i}}\right)\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}},
\;\;\textnormal{and}
\\
\widehat{\Var}^{(2+)}\!\left[\,\widehat{T}\,\right]\!(s)
&:=&
\sum_{i\in s^{(1)}}\,\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})}{\left(\pi^{(1)}_{i}\right)^{2}}
\end{eqnarray*}
are unbiased estimators for
$\Var\!\left[\;\widehat{T}\;\right]$,\;
$\textnormal{V}_{\textnormal{PSU}} := \Var^{(1)}\!\left(E^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)$,
and\;
$\textnormal{V}_{\textnormal{subsampling}} := E^{(1)}\!\left(\Var^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)$,
respectively.
\end{theorem}

\begin{corollary}
\begin{equation}
\widehat{\Var}^{(1)}\!\left[\,\widehat{T}\,\right]\!(s)
\;\;=\;\;
\widehat{\Var}\!\left[\,\widehat{T}\,\right]\!(s)
\;\;-\;\;
\widehat{\Var}^{(2+)}\!\left[\,\widehat{T}\,\right]\!(s)
\end{equation}
\end{corollary}

\proof

\begin{eqnarray*}
\Var^{(1)}\!\left[E^{(2+)}\!\left[\;\left.\widehat{T}\;\right\vert\;s^{(1)}\;\right]\right]
&=&
\Var^{(1)}\!\left[E^{(2+)}\!\left[\;\left.
\sum_{i\in s^{(1)}}\,\frac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\;\right\vert\;s^{(1)}\;\right]\right]
\\
&=&
\Var^{(1)}\!\left[\sum_{i\in s^{(1)}}\,
\frac{E^{(2+)}\!\left[\;\widehat{T}_{i}(s^{(2+)}_{i})\;\right]}{\pi^{(1)}_{i}}
\right]
\\
&=&
\Var^{(1)}\!\left[\sum_{i\in s^{(1)}}\,\frac{T_{i}}{\pi^{(1)}_{i}}\right]
\\
&=&
\sum_{i\in U^{(1)}}\sum_{j\in U^{(1)}}\,\Delta^{(1)}_{ij}\frac{T_{i}}{\pi^{(1)}_{i}}\frac{T_{j}}{\pi^{(1)}_{j}}
\end{eqnarray*}

\begin{eqnarray*}
E^{(1)}\!\left[\Var^{(2+)}\!\left[\;\left.\widehat{T}\;\right\vert\;s^{(1)}\;\right]\right]
&=&
E^{(1)}\!\left[\Var^{(2+)}\!\left[\;\left.
\sum_{i\in s^{(1)}}\,\frac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\;\right\vert\;s^{(1)}\;\right]\right]
\\
&=&
E^{(1)}\!\left[\;\sum_{i\in s^{(1)}}\,
\Var^{(2+)}\!\left[\;\frac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}\;\right]
\right]
\\
&=&
E^{(1)}\!\left[\;\sum_{i\in s^{(1)}}\,
\frac{\Var^{(2+)}\!\left[\widehat{T}_{i}(s^{(2+)}_{i})\;\right]}{\left(\pi^{(1)}_{i}\right)^{2}}
\right]
\\
&=&
E^{(1)}\!\left[\;\sum_{i\in s^{(1)}}\,
\frac{V_{i}/\pi^{(1)}_{i}}{\pi^{(1)}_{i}}
\right]
\\
&=&
\;\sum_{i\in U^{(1)}}\,\frac{V_{i}}{\pi^{(1)}_{i}}
\\
\end{eqnarray*}

\begin{eqnarray*}
E\!\left(\widehat{\Var}^{(2+)}\!\left(\,\widehat{T}\,\right)\,\right)
&=&
E\!\left(\;\sum_{i\in s^{(1)}}\,\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})}{\left(\pi^{(1)}_{i}\right)^{2}}\;\right)
\;\;=\;\; E^{(1)}\!\left(E^{(2+)}\!\left(\;\left.\sum_{i\in s^{(1)}}\,\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})/\pi^{(1)}_{i}}{\pi^{(1)}_{i}}\;\right\vert\;s^{(1)}\;\right)\right)
\\
&=& E^{(1)}\!\left(\;\sum_{i\in s^{(1)}}\,\dfrac{\left.E^{(2+)}\!\left[\,\left.\widehat{V}_{i}(s^{(2+)}_{i})\,\right\vert\,s^{(1)}\,\right]\right/\pi^{(1)}_{i}}{\pi^{(1)}_{i}}\;\right)
\;\;=\;\; E^{(1)}\!\left(\;\sum_{i\in s^{(1)}}\,\dfrac{\left.V_{i}\right/\pi^{(1)}_{i}}{\pi^{(1)}_{i}}\;\right)
\;\;=\;\; \sum_{i \in U^{(1)}}\,\dfrac{V_{i}}{\pi^{(1)}_{i}}
\\
&=& E^{(1)}\!\left(\Var^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)
\;\;=\;\; \textnormal{V}_{\textnormal{PSU}}
\end{eqnarray*}
Similarly,
\begin{eqnarray*}
E\!\left(\;\sum_{i\in s^{(1)}}\,\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}\;\right)
&=& E^{(1)}\!\left(E^{(2+)}\!\left(\;\left.\sum_{i\in s^{(1)}}\,\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}\;\right\vert\;s^{(1)}\;\right)\right)
\;\;=\;\;E^{(1)}\!\left(\;\sum_{i\in s^{(1)}}\,\dfrac{\left.E^{(2+)}\!\left[\,\widehat{V}_{i}(s^{(2+)}_{i})\,\right\vert\,s^{(1)}\,\right]}{\pi^{(1)}_{i}}\;\;\right)
\\
&=& E^{(1)}\!\left(\;\sum_{i\in s^{(1)}}\,\dfrac{V_{i}}{\pi^{(1)}_{i}}\;\;\right)
\;\;=\;\;\sum_{i \in U^{(1)}}\,V_{i}
\end{eqnarray*}
Next, observe that
\begin{eqnarray*}
E\!\left[\;\;
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\cdot
\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
\;\;\right]
&=&
E^{(1)}\!\left(E^{(2+)}\!\left(\;
\left.
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\cdot
\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
\;\;\right\vert\;
s^{(1)}
\;\right)\right)
\\
&=&
E^{(1)}\!\left(\;
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{E^{(2+)}\!\left[\;\left.\widehat{T}_{i}(s^{(2+)}_{i})\cdot\widehat{T}_{j}(s^{(2+)}_{j})\;\right\vert\;s^{(1)}\;\right]}{\pi^{(1)}_{i}\,\pi^{(1)}_{j}}
\;\right)
\end{eqnarray*}
Now, observe {\color{red}(the key technical observation)} that
\begin{equation*}
E^{(2+)}\!\left[\;\left.\widehat{T}_{i}(s^{(2+)}_{i})\cdot\widehat{T}_{j}(s^{(2+)}_{j})\;\right\vert\;s^{(1)}\;\right]
\;\;=\;\;
E^{(2+)}\!\left[\;\widehat{T}_{i}(s^{(2+)}_{i})\cdot\widehat{T}_{j}(s^{(2+)}_{j})\right]
\;\;=\;\;
\left\{
\begin{array}{ll}
\Var^{(2+)}\!\left(\,\widehat{T}_{i}\,\right) + E^{(2+)}\!\left(\,\widehat{T}_{i}\,\right)^{2}, & \textnormal{if}\;\; i = j, \\
E^{(2+)}\!\left(\,\widehat{T}_{i}\,\right)\cdot E^{(2+)}\!\left(\,\widehat{T}_{i}\,\right)      , & \textnormal{if}\;\; i \neq j
\end{array}
\right.
\end{equation*}
Hence,
\begin{eqnarray*}
E\!\left[\;\;
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\cdot
\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
\;\;\right]
&=&
E^{(1)}\!\left(\,
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{E^{(2+)}\!\left[\;\left.\widehat{T}_{i}(s^{(2+)}_{i})\cdot\widehat{T}_{j}(s^{(2+)}_{j})\;\right\vert\;s^{(1)}\;\right]}{\pi^{(1)}_{i}\,\pi^{(1)}_{j}}
\,\right)
\\
&=&
E^{(1)}\!\left(\,
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{T_{i}}{\pi^{(1)}_{i}}\cdot\dfrac{T{j}}{\pi^{(1)}_{j}}
\,+\,
\sum_{i\in s^{(1)}}\,
\dfrac{\left.(1-\pi^{(1)}_{i})\,V_{i}\right/\pi^{(1)}_{i}}{\pi^{(1)}_{i}}
\,\right)
\\
&=&
\sum_{i \in U^{(1)}}\,\sum_{j \in U^{(1)}}\,
\Delta^{(1)}_{ij} \cdot \dfrac{T_{i}}{\pi^{(1)}_{i}} \cdot \dfrac{T{j}}{\pi^{(1)}_{j}}
\;+\;
\sum_{i \in U^{(1)}} \, \dfrac{(1-\pi^{(1)}_{i})}{\pi^{(1)}_{i}}\cdot V_{i}
\\
&=&
\sum_{i \in U^{(1)}}\,\sum_{j \in U^{(1)}}\,
\Delta^{(1)}_{ij} \cdot \dfrac{T_{i}}{\pi^{(1)}_{i}} \cdot \dfrac{T{j}}{\pi^{(1)}_{j}}
\;+\;
\sum_{i \in U^{(1)}} \dfrac{V_{i}}{\pi^{(1)}_{i}}
\;-\;
\sum_{i \in U^{(1)}} V_{i}
\end{eqnarray*}
We may now establish that
\begin{eqnarray*}
E\!\left[\;\widehat{\Var}\!\left(\,\widehat{T}\,\right)\;\right]
&=&
E\!\left[\;
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\cdot
\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
\;+\;
\sum_{i\in s^{(1)}}\,\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\;\right]
\\
&=&
\left\{
\sum_{i \in U^{(1)}}\,\sum_{j \in U^{(1)}}\,
\Delta^{(1)}_{ij} \cdot \dfrac{T_{i}}{\pi^{(1)}_{i}} \cdot \dfrac{T{j}}{\pi^{(1)}_{j}}
\;+\;
\sum_{i \in U^{(1)}} \dfrac{V_{i}}{\pi^{(1)}_{i}}
\;-\;
\sum_{i \in U^{(1)}} V_{i}
\right\}
\;+\;
\left\{\;\sum_{i \in U^{(1)}} V_{i}\;\right\}
\\
&=&
\sum_{i \in U^{(1)}}\,\sum_{j \in U^{(1)}}\,
\Delta^{(1)}_{ij} \cdot \dfrac{T_{i}}{\pi^{(1)}_{i}} \cdot \dfrac{T{j}}{\pi^{(1)}_{j}}
\;+\;
\sum_{i \in U^{(1)}} \dfrac{V_{i}}{\pi^{(1)}_{i}}
\\
&=&
\Var\!\left(\,\widehat{T}\,\right)
\end{eqnarray*}
Lastly, note that
\begin{equation*}
\widehat{\Var}^{(1)}\!\left[\,\widehat{T}\,\right]\!(s)
\;\;=\;\;
\widehat{\Var}\!\left[\,\widehat{T}\,\right]\!(s)
\;\;-\;\;
\widehat{\Var}^{(2+)}\!\left[\,\widehat{T}\,\right]\!(s)
\end{equation*}
Hence,
\begin{eqnarray*}
E\!\left[\;
\widehat{\Var}^{(1)}\!\left(\,\widehat{T}\,\right)
\,\right]
&=&
E\!\left[\;\widehat{\Var}\!\left(\,\widehat{T}\,\right)\,\right]
\;\;-\;\;
E\!\left[\;\widehat{\Var}^{(2+)}\!\left(\,\widehat{T}\,\right)\,\right]
\\
&=&
\Var\!\left[\;\widehat{T}\;\right] \;-\; E^{(1)}\!\left(\Var^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)
\\
&=&
\Var^{(1)}\!\left(E^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)
\;+\;
E^{(1)}\!\left(\Var^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)
\;-\;
E^{(1)}\!\left(\Var^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)
\\
&=&
\Var^{(1)}\!\left(E^{(2+)}(\,\left.\widehat{T}\,\right\vert s^{(1)})\right)
\;\;=\;\;\textnormal{V}_{\textnormal{subsampling}}
\end{eqnarray*}
\qed

          %%%%% ~~~~~~~~~~~~~~~~~~~~ %%%%%

%\clearpage
\section{Variance estimation for three-stage sampling}
\setcounter{theorem}{0}
\setcounter{equation}{0}

Let $U$ be a finite population and $\mathcal{P}(U)$ the power set of $U$.
Let $p : \mathcal{S} \longrightarrow (0,1]$ be a three-stage sampling design,
where $\mathcal{S} \subset \mathcal{P}(U)$ is the set of all admissible samples under the design $p$.
We express the three-stage structure of the population $U$, with respect to the three-stage design $p$, as follows:
\begin{equation}
U
\;\;=\;\; \bigsqcup_{i \in U^{(1)}} U^{(2+)}_{i}
\;\;=\;\; \bigsqcup_{i \in U^{(1)}_{\color{white}i}} \bigsqcup_{a \in U^{(2)}_{i}}\, U^{(3)}_{ia},
\end{equation}
where $U^{(1)}$ is the set of all primary sampling units (PSU),
and for each PSU $i \in U^{(1)}$, $U^{(2)}_{i}$ denotes the set of all secondary sampling units (SSU) contained in $i \in U^{(1)}$,
and for each SSU $a \in U^{(2)}_{i}$, $U^{(3)}_{ia}$ denotes the set of all tertiary sampling units (TSU) contained in $a \in U^{(2)}_{i}$.
Similarly, we express the three-stage structure of every admissible sample $s \in \mathcal{S}$ as follows:
\begin{equation}
s
\;\;=\;\; \bigsqcup_{i\in s^{(1)}} s^{(2+)}_{i}
\;\;=\;\; \bigsqcup_{i\in s^{(1)}_{\color{white}i}} \bigsqcup_{a \in s^{(2)}_{i}}\, s^{(3)}_{ia}
\end{equation}
Let $y : U \longrightarrow \Re$ be a population characteristic.
Let $T$ be its population total, i.e.
\begin{equation}
T
\;\;=\;\; \sum_{u\in U}\,y_{u}
\;\;=\;\; \sum_{i\in U^{(1)}_{\color{white} i}}T_{i}
\;\;=\;\; \sum_{i\in U^{(1)}_{\color{white} i}}\,\sum_{a \in U^{(2)}_{ia}}T_{ia}
\;\;=\;\; \sum_{i \in U^{(1)}_{\color{white} i}}\,\sum_{a \in U^{(2)}_{i}}\,\sum_{u \in U^{(3)}_{ia}}\,y_{u}
\end{equation}

\begin{theorem}
\mbox{}\vskip 0.1cm
\noindent
For a three-stage sampling design with invariant and independent subsampling,
\begin{enumerate}
%%%%%%%%%%%
\item The random variable $\widehat{T} : \mathcal{S} \longrightarrow \Re$, defined as follows:
\begin{equation*}
\widehat{T}(s)
\;\;:=\;\; \sum_{i\in s^{(1)}}\,\frac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\;\; =\;\; \sum_{i\in s^{(1)}_{\color{white}i}}\,\frac{1}{\pi^{(1)}_{i}}\left(\sum_{a \in s^{(2)}_{i}} \dfrac{\widehat{T}_{ia}(s^{(3)}_{ia})}{\pi^{(2)}_{i\vert a}}\right)
\;\; =\;\; \sum_{i\in s^{(1)}_{\color{white}i}}\,\frac{1}{\pi^{(1)}_{i}}\left(\sum_{a \in s^{(2)}_{i}} \dfrac{1}{\pi^{(2)}_{i\vert a}}\left(\sum_{u\in s^{(3)}_{ia}}\dfrac{y_{u}}{\pi^{(3)}_{ia\vert u}}\right)\right)
\end{equation*}
is a design-unbiased estimator for $T$, i.e. $E\!\left[\,\widehat{T}\,\right] = T$.
%%%%%%%%%%%
\item
If the three-stage sampling design has invariant and independent subsampling,
then the design-variance of $\widehat{T}$ can be given by:
\begin{eqnarray*}
&& \Var\!\left[\;\widehat{T}\;\right] \\
&=&
\Var^{(1)}\!\left(E^{(2+)}\!\left(\;\left.\widehat{T}\;\right\vert\,s^{(1)}\,\right)\right)
\;+\;
E^{(1)}\!\left(\Var^{(2+)}\!\left(\;\left.\widehat{T}\;\right\vert\,s^{(1)}\,\right)\right)
\\
&=&
\Var^{(1)}\!\left(E^{(2+)}\!\left(\;\left.\widehat{T}\;\right\vert\,s^{(1)}\,\right)\right)
\;+\;
E^{(1)}\!\left\{
\Var^{(2)}\!\left(\left.E^{(3)}\!\left(\left.\widehat{T}\;\right\vert\,s^{(2)}\right)\;\right\vert\,s^{(1)}\,\right)
\,+\,
E^{(2)}\!\left(\left.\Var^{(3)}\!\left(\left.\widehat{T}\;\right\vert\,s^{(2)}\right)\;\right\vert\,s^{(1)}\,\right)
\right\}
\\
&=&
\underset{\textnormal{V}_{\textnormal{PSU}}}{\underbrace{
\Var^{(1)}\!\left(E^{(2+)}\!\left(\;\left.\widehat{T}\;\right\vert\,s^{(1)}\,\right)\right)
}}
\;+\;
\underset{\textnormal{V}_{\textnormal{SSU}}}{\underbrace{
E^{(1)}\!\left\{
\Var^{(2)}\!\left(\left.E^{(3)}\!\left(\left.\widehat{T}\;\right\vert\,s^{(2)}\right)\;\right\vert\,s^{(1)}\,\right)
\right\}
}}
\,+\,
\underset{\textnormal{V}_{\textnormal{TSU}}}{\underbrace{
E^{(1)}\!\left\{
E^{(2)}\!\left(\left.\Var^{(3)}\!\left(\left.\widehat{T}\;\right\vert\,s^{(2)}\right)\;\right\vert\,s^{(1)}\,\right)
\right\}
}}
\end{eqnarray*}
where
\begin{eqnarray*}
\textnormal{V}_{\textnormal{PSU}}
&:=&\Var^{(1)}\!\left(E^{(2+)}\!\left(\,\left.\widehat{T}\;\right\vert\;s^{(1)}\;\right)\right)
\;\;=\;\;
\sum_{i\in U^{(1)}}\sum_{j\in U^{(1)}}\,\Delta^{(1)}_{ij}\frac{T_{i}}{\pi^{(1)}_{i}}\frac{T_{j}}{\pi^{(1)}_{j}},
\\
\textnormal{V}_{\textnormal{SSU}}
&:=&
E^{(1)}\!\left\{\Var^{(2)}\!\left(\,\left.E^{(3)}(\;\left.\widehat{T}\;\right\vert\,s^{(2)}\,)\;\right\vert\;s^{(1)}\,\right)\right\}
\;\;=\;\;
\sum_{i\in U^{(1)}}\frac{V^{(2)}_{i}}{\pi^{(1)}_{i}},
\quad\textnormal{and}
\\
\textnormal{V}_{\textnormal{TSU}}
&:=&
E^{(1)}\!\left\{E^{(2)}\!\left(\,\left.\Var^{(3)}(\;\left.\widehat{T}\;\right\vert\,s^{(2)}\,)\;\right\vert\;s^{(1)}\,\right)\right\}
\;\;=\;\;
\sum_{i\in U^{(1)}_{\color{white}i}}\dfrac{1}{\pi^{(1)}_{i}}\left(\sum_{a \in U^{(2)}_{i}}\,\dfrac{V^{(3)}_{ia}}{\pi^{(2)}_{i \vert a}}\right),
\end{eqnarray*}
with
\begin{eqnarray*}
\Delta^{(1)}_{ij}
&:=&
\left\{
\begin{array}{cl}
\pi^{(1)}_{i}\left(1 - \pi^{(1)}_{i}\right), & \textnormal{if}\;\; i = j
\\ \\
\pi^{(1)}_{ij} - \pi^{(1)}_{i}\pi^{(1)}_{j}, & \textnormal{if}\;\; i \neq j
\end{array}
\right.
\\
V^{(2)}_{i}
&:=& \Var^{(2)}\!\left[\;\sum_{a\in s^{(2)}_{i}}\,\dfrac{T_{ia}}{\pi^{(2)}_{i \vert a}}\;\right]
\;=\; \sum_{a\in U^{(2)}_{i}}\,\sum_{b\in U^{(2)}_{i}}\,\Delta^{(2)}_{i \vert ab}\cdot\dfrac{T_{ia}}{\pi^{(2)}_{i \vert a}}\cdot\dfrac{T_{ib}}{\pi^{(2)}_{i \vert b}}
\\
\Delta^{(2)}_{i \vert ab}
&:=&
\left\{
\begin{array}{cl}
\pi^{(2)}_{i \vert a}\left(1 - \pi^{(2)}_{i\vert a}\right), & \textnormal{if}\;\; a = b
\\ \\
\pi^{(2)}_{i \vert ab} - \pi^{(2)}_{i \vert a}\,\pi^{(2)}_{i \vert b}, & \textnormal{if}\;\; a \neq b
\end{array}
\right.
\\
V^{(3)}_{ia}
&:=&
\Var^{(3)}\!\left(\;\left.\widehat{T}_{ia}\;\right\vert\;s^{(1)}, s^{(2)}\,\right)
\end{eqnarray*}
%%%%%%%%%%%
%\begin{eqnarray*}
%\widehat{\Var}^{(1)}\!\left[\,\widehat{T}\,\right]\!(s)
%&:=&
%\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
%\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
%\cdot
%\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
%\cdot
%\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
%\;+\;
%\sum_{i\in s^{(1)}}\,\left(1 - \dfrac{1}{\pi^{(1)}_{i}}\right)\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}},
%\;\;\textnormal{and}
%\\
%\widehat{\Var}^{(2+)}\!\left[\,\widehat{T}\,\right]\!(s)
%&:=&
%\sum_{i\in s^{(1)}}\,\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})}{\left(\pi^{(1)}_{i}\right)^{2}}
%\end{eqnarray*}
\end{enumerate}
%are unbiased estimators for
%$\Var\!\left[\;\widehat{T}\;\right]$,
%$\Var^{(1)}\!\left[E^{(2+)}\!\left[\;\left.\widehat{T}\;\right\vert\;s^{(1)}\;\right]\right]$,
%and
%$E^{(1)}\!\left[\Var^{(2+)}\!\left[\;\left.\widehat{T}\;\right\vert\;s^{(1)}\;\right]\right]$,
%respectively.
\end{theorem}

\begin{theorem}
\mbox{}
\vskip 0.1cm
\noindent
For a three-stage sampling design $p : \mathcal{S} \subset \mathcal{P}(U) \longrightarrow \Re$
with invariant and independent subsampling,
let $\widehat{T} : \mathcal{S} \longrightarrow \Re$ be the random variable defined as follows:
\begin{equation*}
\widehat{T}(s)
\;\;:=\;\; \sum_{i\in s^{(1)}}\,\frac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\;\; =\;\; \sum_{i\in s^{(1)}_{\color{white}i}}\,\frac{1}{\pi^{(1)}_{i}}\left(\sum_{a \in s^{(2)}_{i}} \dfrac{\widehat{T}_{ia}(s^{(3)}_{ia})}{\pi^{(2)}_{i\vert a}}\right)
\;\; =\;\; \sum_{i\in s^{(1)}_{\color{white}i}}\,\frac{1}{\pi^{(1)}_{i}}\left(\sum_{a \in s^{(2)}_{i}} \dfrac{1}{\pi^{(2)}_{i\vert a}}\left(\sum_{u\in s^{(3)}_{ia}}\dfrac{y_{u}}{\pi^{(3)}_{ia\vert u}}\right)\right)
\end{equation*}
Recall that $\widehat{T}$ is an unbiased estimator of the population total
\begin{equation*}
T
\;\;:= \;\; \sum_{i\in U^{(1)}_{\color{white} i}}T_{i}
\;\;:= \;\; \sum_{i\in U^{(1)}_{\color{white} i}}\;\sum_{a \in U^{(2)}_{ia}}T_{ia}
\;\;:=\;\; \sum_{i \in U^{(1)}_{\color{white} i}}\,\sum_{a \in U^{(2)}_{i}}\,\sum_{u \in U^{(3)}_{ia}}\,y_{u}
\end{equation*}
Let $\widehat{\Var}\!\left[\,\widehat{T}\,\right] : \mathcal{S} \longrightarrow \Re$
be the random variable defined in a recursive manner as follows:
\begin{equation*}
\begin{array}{cclcl}
\widehat{\Var}\!\left[\,\widehat{T}\,\right]\!(s)
&:=&
\underset{i\in s^{(1)}}{\sum}\,\underset{j\in s^{(1)}}\sum\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\cdot
\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
&+&
\underset{i\in s^{(1)}}{\sum}\,\dfrac{\widehat{\Var}\!\left[\widehat{T}_{i}\right]\!(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\\ \\
\widehat{\Var}\!\left[\widehat{T}_{i}\right]\!(s^{(2+)}_{i})
&:=&
\underset{a\in s^{(2)}_{i}}{\sum}\,\underset{b\in s^{(2)}_{i}}{\sum}
\Delta^{(2)}_{i \vert ab}\cdot\dfrac{\widehat{T}_{ia}(s^{(3)}_{ia})}{\pi^{(2)}_{i \vert a}}\cdot\dfrac{\widehat{T}_{ib}(s^{(3)}_{ib})}{\pi^{(2)}_{i \vert b}}
&+&
\underset{a \in s^{^{(2)}}_{i}}{\sum}\,\dfrac{\widehat{\Var}\!\left[\widehat{T}_{ia}\right]\!(s^{(3)}_{ia})}{\pi^{(2)}_{i \vert a}}
\\ \\
\widehat{\Var}\!\left[\widehat{T}_{ia}\right]\!(s^{(3)}_{ia})
&:=&
\underset{u \in s^{(3)}_{ia}}{\sum}\,\underset{v \in s^{(3)}_{ia}}{\sum}\Delta^{(3)}_{ia\vert uv}\cdot\dfrac{y_{u}}{\pi^{(3)}_{ia\vert u}}\cdot\dfrac{y_{v}}{\pi^{(3)}_{ia\vert v}}
\end{array}
\end{equation*}
where
\begin{eqnarray*}
\Delta^{(1)}_{ij}
&:=&
\left\{
\begin{array}{cl}
\pi^{(1)}_{i}\left(1 - \pi^{(1)}_{i}\right), & \textnormal{if}\;\; i = j
\\ \\
\pi^{(1)}_{ij} - \pi^{(1)}_{i}\pi^{(1)}_{j}, & \textnormal{if}\;\; i \neq j
\end{array}
\right.
\\ \\
\Delta^{(2)}_{i \vert ab}
&:=&
\left\{
\begin{array}{cl}
\pi^{(2)}_{i \vert a}\left(1 - \pi^{(2)}_{i\vert a}\right), & \textnormal{if}\;\; a = b
\\ \\
\pi^{(2)}_{i \vert ab} - \pi^{(2)}_{i \vert a}\,\pi^{(2)}_{i \vert b}, & \textnormal{if}\;\; a \neq b
\end{array}
\right.
\\ \\
\Delta^{(3)}_{ia \vert uv}
&:=&
\left\{
\begin{array}{cl}
\pi^{(3)}_{ia \vert u}\left(1 - \pi^{(3)}_{ia \vert u}\right), & \textnormal{if}\;\; u = v
\\ \\
\pi^{(3)}_{ia \vert uv} - \pi^{(3)}_{ia \vert u}\,\pi^{(3)}_{ia \vert v}, & \textnormal{if}\;\; u \neq v
\end{array}
\right.
\end{eqnarray*}
Then, $\widehat{\Var}\!\left[\,\widehat{T}\,\right]$ is a design-unbiased estimator of the design variance
$\Var\!\left[\,\widehat{T}\,\right]$ of the $\widehat{T}$.
\end{theorem}

\begin{corollary}\mbox{}\\
For a three-stage sampling design with invariant and independent subsampling,
the fully expanded expression for $\widehat{\Var}\!\left[\,\widehat{T}\,\right]$ is as follows:
\begin{eqnarray*}
\widehat{\Var}\!\left[\,\widehat{T}\,\right]\!(s)
&:=&
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\cdot
\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
\;+\;
\sum_{i\in s^{(1)}}\,\dfrac{\widehat{V}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\\
&=&
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(1)}_{ij}}
\cdot
\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\cdot
\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
\\&&
+
\sum_{i\in s^{(1)}}\,\dfrac{1}{\pi^{(1)}_{i}}\,\left\{
\sum_{a\in s^{(2)}_{i}}\,\sum_{b\in s^{(2)}_{i}}
\Delta^{(2)}_{i \vert ab}\cdot\dfrac{\widehat{T}_{ia}(s^{(3)}_{ia})}{\pi^{(2)}_{i \vert a}}\cdot\dfrac{\widehat{T}_{ib}(s^{(3)}_{ib})}{\pi^{(2)}_{i \vert b}}
+
\sum_{a \in s^{^{(2)}}_{i}}\,\dfrac{\widehat{V}_{ia}}{\pi^{(2)}_{i \vert a}}
\right\}
\\
&=&
\sum_{i\in s^{(1)}}\,\sum_{j\in s^{(1)}}\,
\dfrac{\Delta^{(1)}_{ij}}{\pi^{(i)}_{ij}}
\cdot
\dfrac{\widehat{T}_{i}(s^{(2+)}_{i})}{\pi^{(1)}_{i}}
\cdot
\dfrac{\widehat{T}_{j}(s^{(2+)}_{j})}{\pi^{(1)}_{j}}
\\&&
+
\sum_{i\in s^{(1)}}\,\dfrac{1}{\pi^{(1)}_{i}}\,\left\{
\sum_{a\in s^{(2)}_{i}}\,\sum_{b\in s^{(2)}_{i}}
\Delta^{(2)}_{i \vert ab}\cdot\dfrac{\widehat{T}_{ia}(s^{(3)}_{ia})}{\pi^{(2)}_{i \vert a}}\cdot\dfrac{\widehat{T}_{ib}(s^{(3)}_{ib})}{\pi^{(2)}_{i \vert b}}
+
\sum_{a \in s^{^{(2)}}_{i}}\,\dfrac{1}{\pi^{(2)}_{i \vert a}}
\left(\sum_{u \in s^{(3)}_{ia}}\,\sum_{v \in s^{(3)}_{ia}}\Delta^{(3)}_{ia\vert uv}\dfrac{y_{u}}{\pi^{(3)}_{ia\vert u}}\dfrac{y_{v}}{\pi^{(3)}_{ia\vert v}}\right)
\right\},
\end{eqnarray*}
where
\begin{equation*}
\widehat{T}_{ia}(s^{(3)}_{ia})\;=\;\sum_{u \in s^{(3)}_{ia}}\,\dfrac{y_{u}}{\pi^{(3)}_{ia\vert u}}
\quad\textnormal{and}\quad
\widehat{T}_{i}(s^{(2+)}_{i})
\;=\;\sum_{a\in s^{(2)}_{i}}\dfrac{\widehat{T}_{ia}(s^{(3)}_{ia})}{\pi^{(2)}_{i\vert a}}
\;=\;\sum_{a\in s^{(2)}_{i}}\dfrac{1}{\pi^{(2)}_{i\vert a}}\left(\sum_{u \in s^{(3)}_{ia}}\,\dfrac{y_{u}}{\pi^{(3)}_{ia\vert u}}\right)
\end{equation*}
\begin{equation*}
\Delta^{(3)}_{ia \vert uv}
\;\;:=\;\;
\left\{
\begin{array}{cl}
\pi^{(3)}_{ia \vert u}\left(1 - \pi^{(3)}_{ia \vert u}\right), & \textnormal{if}\;\; u = v
\\ \\
\pi^{(3)}_{ia \vert uv} - \pi^{(3)}_{ia \vert u}\,\pi^{(3)}_{ia \vert v}, & \textnormal{if}\;\; u \neq v
\end{array}
\right.
\end{equation*}
\end{corollary}
